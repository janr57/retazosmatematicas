% coord_R2.tex
%
% Copyright (C) 2022--2026 José A. Navarro Ramón <janr.devel@gmail.com>
% Licencia del código GPLv2
% Licencia Creative Commons Recognition Non-Commercial Share-alike.
% (CC-BY-NC-SA)

\chapter{Sistemas de coordenadas en
  \mathinhead{\symbb{R}^2}{espr2})}
Este capítulo tiene dos objetivos:
\begin{enumerate}
\item Analizar distintos sistemas de coordenadas en el plano $\symbb{R}^2$ y la expresión
  del resultado de distintas operaciones en estos sistema.
\item Introducir elementos básicos de geometría diferencial necesarios para la
  realización del objetivo anterior.
\end{enumerate}

En el capítulo se analizan brevemente unos pocos sistemas de coordenadas en el plano,
seguido de la acción del operador nabla sobre campos escalares y vectoriales
n
El capítulo comienza recordando conceptos básicos del sistema de coordenadas cartesianas
rectangulares, en adelante, \emph{coordenadas cartesianas}, mientras no se diga lo
contrario.

Se sigue con una descripción de sistemas de coordenadas cartesianas oblícuas, en adelante,
coordenadas oblícuas, mientras no se diga lo contrario. 

Después nos adentramos en la descripción de las coordenadas polares planas.

Se introducen determinados conceptos de geometría diferencial, como \emph{base natural},
\emph{base unitaria}, \emph{métrica}, \emph{factores de escala},
\emph{vectores y coordenadas covariantes y contravariantes}, \emph{tensor},
\emph{espacio dual}, etc., unos con más detalle que otros, conforme se van necesitando,
de manera que, al final del capítulo, se termina con una idea básica de esta rama de las
matemáticas. Lo nos interesa ahora es que, con estos conocimientos, se podrán seguir los
siguientes capítulos que versen sobre otros sistemas de coordenadas. Por descontado, la
geometría diferencial es mucho más que lo que aquí se presenta.

\section{Coordenadas cartesianas rectangulares}
Vector de posición de cualquier punto del espacio $\symbb{R}^2$ en coordenadas cartesianas
\begin{equation}\label{eq:R2-r-cartesianas}
  \vvv{r}
  = x\,\uvec{\i} + y\,\uvec{\j}
\end{equation}
\begin{figure}[ht]
  % Escala
  \def\scl{1}
  %
  \pgfmathsetmacro{\EJESEXTRA}{-0.2}
  \pgfmathsetmacro{\EJESLONG}{2.3}
  % Eje x
  \pgfmathsetmacro{\XMLONG}{\EJESEXTRA}
  \pgfmathsetmacro{\XPLONG}{\EJESLONG}
  % Eje y
  \pgfmathsetmacro{\YMLONG}{\EJESEXTRA}
  \pgfmathsetmacro{\YPLONG}{\EJESLONG}
  % Versores
  \pgfmathsetmacro{\VMOD}{0.6}
  % Vector P
  \pgfmathsetmacro{\PMOD}{2.5}
  \pgfmathsetmacro{\PANG}{40}
  % Fondo
  \pgfmathsetmacro{\HORZ}{0.25}
  \pgfmathsetmacro{\VERT}{0.25}
  % 
  \centering
  \begin{tikzpicture}[%
    scale=\scl,
    every node/.style={black,font=\small},
    eje/.style={->},
    proyeccion/.style={black!60, densely dotted},
    vector/.style={-{Latex[round]}, shorten >=1.2pt, line width=.8pt,\colorV},
    versor/.style={-{Latex[round, width=4pt, length=6pt]}, line width=1pt, \colorVred},
    textooriginal/.style={\colorTorig},
    pcirculo/.style={fill=\colorPorig, draw=black},
    angulogirado/.style={fill=\colorAngGreen, draw=\colorGirodos},
    background/.style={%
      line width=\bgborderwidth,
      draw=\bgbordercolor,
      fill=\bgcolor,
    },
    ]
    % COORDENADAS
    % Origen
    \coordinate (O) at (0,0);
    % Extremo izdo del eje x e inferior del eje y
    \coordinate (xini) at (\XMLONG cm,0);
    \coordinate (yini) at (0,\YMLONG cm);
    \coordinate (ifin) at (\VMOD cm, 0);
    \coordinate (jfin) at (0, \VMOD cm);
    % Eje x
    \path[save path=\ejex] (xini) -- coordinate[pos=0.55] (xtexto) (\XPLONG cm, 0)
    coordinate (xfin);
    % Eje y
    \path[save path=\ejey] (yini) -- coordinate[pos=0.55] (ytexto) (0, \YPLONG cm)
    coordinate (yfin);
    % Versores i y j
    \path[save path=\i] (O) -- coordinate[pos=0.5] (itexto) (ifin);
    \path[save path=\j] (O) -- coordinate[pos=0.45] (jtexto) (jfin);    
    % Vector
    \path[save path=\vector] (O) -- coordinate[pos=0.5] (pmid) (\PANG:\PMOD cm)
    coordinate (P);
    % Proyección de P en los ejes
    \path[save path=\proyx] (P) |- (xfin);
    \path[save path=\proyy] (P) -| (yfin);

    % DIBUJOS
    % Proyección de P en los ejes
    \draw[proyeccion, use path=\proyx];
    \draw[proyeccion, use path=\proyy];
    % Ejes
    % x
    \draw[eje, use path=\ejex];
    \node[right] at (xfin) {$x$};
    \node[below] at (xtexto) {$x$};
    % y
    \draw[eje, use path=\ejey];
    \node[above] at (yfin) {$y$};
    \node[left] at (ytexto) {$y$};
    % Versores
    \draw[versor, use path=\i];
    \node[below, \colorTred] at (itexto) {\scriptsize $\uvec{\i}$};
    \draw[versor, use path=\j];
    \node[left, \colorTred] at (jtexto) {\scriptsize $\uvec{\j}$};
    % Vector y punto  P
    \draw[vector, use path=\vector];
    \node[above left=-3pt and -1pt] at (pmid) {$\vvv{r}$};
    \filldraw[fill=green, draw=black] (P) circle[radius=1.2pt];
    \node[above] at (P) {$P$};
    
    % Origen
    \filldraw (O) circle [radius=.2pt];
    % Fondo amarillo
    \coordinate (SW) at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
    \coordinate (NE) at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);    
    \begin{scope}[on background layer]
      \draw[background] (SW) rectangle (NE);
    \end{scope}
  \end{tikzpicture}
  \caption{Coordenadas cartesianas de un punto $P$ del plano (en verde) y vectores
    unitarios (en rojo). Se puede comprobar que el vector de posición del punto es
    $\vvv{r} = x\uvec{i} + y\uvec{j}$.}
  \label{fig:R2-coordenadas-cartesianas-R2}
\end{figure}

\subsection{Base natural, vectores unitarios y su producto escalar}
\subsubsection{Base natural y vectores unitarios}
Si derivamos el vector de posición anterior \eqref{eq:R2-r-cartesianas}, con respecto a
cada una de las coordenadas, obtenemos los vectores de una  posible base en estas
coordenadas. Estos vectores llevan información concreta acerca de cómo varia la posición
en el espacio cuando variamos cada una de las coordenadas ---tal y como sugieren las
derivadas---, lo que será importante para obtener la métrica en estas coordenadas.

Como
\begin{equation}
  \vvv{r} = x\uvec{\i} + y\uvec{\j}
\end{equation}

Entonces
\begin{subequations}
  \begin{align}\label{eq:R2-ex}
    \vvv{e}_x
    &=
      \dfrac{\partial\vvv{r}}{\partial x}
      = \uvec{\i}\\
    \label{eq:R2-ey}
    \vvv{e}_y
    &= \dfrac{\partial\vvv{r}}{\partial y}
      = \uvec{\j}
  \end{align}
\end{subequations}
Estos vectores forman la denominada \emph{base natural} en cartesianas, que en este
sistema coincide con los vectores unitarios tradicionales $\uvec{\i}$ y $\uvec{\j}$
\begin{equation}\label{eq:R2-basefundamental}
  B=\set{\vvv{e}_x, \vvv{e}_y} = \set{\uvec{\i},\, \uvec{\j}}
\end{equation}

La métrica en cada sistema de coordenadas define la estructura del espacio, en
particular, sin ella no se pueden medir ni distancias ni ángulos. Es como si
proporcionara un sistema de reglas y goniómetros con los cuales medir.

De la equivalencia de la base natural con la unitaria, se puede inferir que la métrica en
coordenadas cartesianas rectangulares en $\symbb{R}^2$ se representará como una matriz
unidad (en el apartado \ref{ssect:R2-metrica-factores_escala} se calculará con detalle).

\subsection{Métrica y factores de escala}
\label{ssect:R2-metrica-factores_escala}

\subsubsection{Producto escalar de los vectores de la base natural}
Los vectores de la base fundamental son vectores unitarios.
La base normalizada en coordenadas cartesianas en este espacio está formada por los vectores $\uvec{\i}$ y $\uvec{\j}$, en los ejes $x$ e $y$, respectivamente.
A continuación resumimos el valor de los productos escalares entre ellos, tal y como
aprendimos en cálculo vectorial fundamental en coordenadas cartesianas o en física
elemental
\begin{subequations}
  \begin{align}
    \label{eq:R2-ii-producto-escalar}
    \vvv{e}_x\cdot\vvv{e}_x = \uvec{\i}\cdot\uvec{\i}
    &= |\uvec{\i}|\,|\uvec{\i}|\cos 0 = 1\\
    \label{eq:R2-ij-producto-escalar}    
    \vvv{e}_x\cdot\vvv{e}_y = \uvec{\i}\cdot\uvec{\j}
    &= |\uvec{\i}|\,|\uvec{\j}|\cos\pi/2 = 0\\
    \label{eq:R2-ji-producto-escalar} 
    \vvv{e}_y\cdot\vvv{e}_x = \uvec{\j}\cdot\uvec{\i}
    &= |\uvec{\j}|\,|\uvec{\i}|\cos\pi/2 = 0\\
    \label{eq:R2-jj-producto-escalar}
    \vvv{e}_y\cdot\vvv{e}_y = \uvec{\j}\cdot\uvec{\j}
    &= |\uvec{\j}|\,|\uvec{\j}|\cos 0 = 1
  \end{align}
\end{subequations}

\subsubsection{Métrica y factores de escala}
La métrica en cartesianas se calcula utilizando los vectores de la base natural, calculada en \eqref{eq:R2-ex} y \eqref{eq:R2-ey}. Los productos escalares se calcularon en
\eqref{eq:R2-ii-producto-escalar}, \eqref{eq:R2-ij-producto-escalar},
\eqref{eq:R2-ji-producto-escalar} y \eqref{eq:R2-jj-producto-escalar}
\begin{equation}\label{eq:R2-metrica-cartesianas}
  \mmm{g}
  = g_{ij}
  = \begin{pmatrix}
    g_{ii} & g_{ij}\\
    g_{ji} & g_{jj}
    \end{pmatrix}
  = \begin{pmatrix}
      \vvv{e}_x\cdot\vvv{e}_x & \vvv{e}_x\cdot\vvv{e}_y\\
      \vvv{e}_y\cdot\vvv{e}_x & \vvv{e}_y\cdot\vvv{e}_y
  \end{pmatrix}
  = \begin{pmatrix}
      \uvec{\i}\cdot\uvec{\i} & \uvec{\i}\cdot\uvec{\j}\\
      \uvec{i}\cdot\uvec{j} & \uvec{\j}\cdot\uvec{\j}
  \end{pmatrix}
  = \begin{pmatrix}
    1 & 0\\
    0 & 1
  \end{pmatrix}
\end{equation}

Se llaman \emph{factores de escala} o \emph{coeficientes métricos} a la raíz cuadrada de
los elementos diagonales en la métrica en un sistema de coordenadas ortogonales, como el
que nos ocupa. En coordenadas cartesianas estándar serían
\begin{align*}
  h_x &= \sqrt{g_{11}} = \sqrt{1} = 1\\
  h_y &= \sqrt{g_{22}} = \sqrt{1} = 1  
\end{align*}

Fijémonos en la métrica \eqref{eq:R2-metrica-cartesianas}:
\begin{itemize}
\item Los elementos no diagonales son nulos. Esto se interpreta como que los vectores
  $\vvv{e}_x$ y $\vvv{e}_y$ son independientes, esto es, son ortogonales.
  Esto implica que un cambio en una coordenada no afecta a la otra. Así, si nos
  desplazamos una distancia cualquiera en el eje $x$, no habremos recorrido ninguna
  distancia en el eje $y$, y viceversa, por lo que $h_{xy}=h_{yx}=0$.
\item Los elementos diagonales valen la unidad. Cada elemento diagonal de la métrica que
  vale la unidad implica que un cambio en la coordenada respectiva implica una distancia
  recorrida de una unidad en el espacio. En realidad, el espacio recorrido es el factor
  de escala correspondiente (la raíz cuadrada del elemento diagonal correspondiente),
  pero en este caso da lo mismo
  \begin{subequations}
    \begin{align}
      \Delta s &= h_x \Delta x = \sqrt{1}\, \Delta x = \Delta x\\
      \Delta s &= h_y \Delta y = \sqrt{1}\, \Delta y = \Delta y
    \end{align}
  \end{subequations}
  Para adquirir algo de intuición, imagina que cambiamos la posición en el eje $x$
  cualquier distancia, digamos un metro, es fácil entender que en el espacio nos habremos
  desplazado esa misma distancia. Por tanto es lógico razonar que el factor de escala
  $h_x$ vale 1. Lo mismo podemos decir para el factor de escala en el eje $y$, $h_y=1$.
\end{itemize}

\subsubsection{Revisión del producto escalar}
Hemos dicho que la métrica permite calcular distancias. En concreto, el cuadrado de la
longitud (módulo) de un vector $\vvv{A}$ se mide realizando el producto escalar del
vector por sí mismo.
El concepto de producto escalar se puede ampliar mediante el cálculo matricial, utilizando
la métrica (en otros sistemas de coordenadas veremos que esto tiene importancia, mientras
que en cartesianas se puede obviar)
\[
  \vvv{v}\cdot\vvv{w}
  =
  \vvv{v}^\transp \mmm{g} \vvv{w}
  =
  \begin{pmatrix}
    v_x &  v_y
  \end{pmatrix}
  \begin{pmatrix}
    1 & 0\\
    0 & 1
  \end{pmatrix}
  \begin{pmatrix}
    w_x\\
    w_y
  \end{pmatrix}
  =
  v_xw_x + v_y w_y
\]
  
Así, el cuadrado del módulo de un vector en cartesianas es
\[
  v^2
  =
  \|\vvv{v}\|^2
  =
  \vvv{v}\cdot\vvv{v}
  =
  \vvv{v}^\transp \mmm{g} \vvv{v}
  =
  \begin{pmatrix}
  v_x &  v_y
\end{pmatrix}
\begin{pmatrix}
  1 & 0\\
  0 & 1
\end{pmatrix}
\begin{pmatrix}
  v_x\\
  v_y
\end{pmatrix}
=
v_x^2 + v_y^2
\]
que coincide con el valor que sabíamos del cálculo vectorial básico.

\subsection{Gradiente, divergencia y laplaciana}
Presentamos un resumen de estas operaciones, tal y como se estudia en un curso básico de
cálculo
\begin{itemize}
\item El gradiente de un campo escalar $\phi(x,y)$ es un vector
\begin{equation}
  \vvv{\nabla}\phi
  = \dfrac{\partial \phi}{\partial x}\,\uvec{\i}
  + \dfrac{\partial \phi}{\partial y}\,\uvec{\j}
  = \begin{pmatrix}
    \partial \phi/\partial x\\
    \partial \phi/\partial y
    \end{pmatrix}
\end{equation}
El vector gradiente de $\phi$ evaluado en un punto genérico $(x,y)$ del dominio de $\phi$
indica la dirección en la cual el campo $\phi$ varía más rápidamente y su módulo
representa el ritmo de variación de $\phi$ en la dirección de dicho vector gradiente.

El operador gradiente se comporta como un vector bajo rotaciones
\begin{equation}
  \vvv{\nabla}
  = \dfrac{\partial}{\partial x}\,\uvec{\i}
  + \dfrac{\partial}{\partial y}\,\uvec{\j}
  = \begin{pmatrix}
    \partial/\partial x\\
    \partial/\partial y
    \end{pmatrix}
\end{equation}

\item La divergencia de un campo vectorial $\vvv{A}=(A_x, A_y)$ es un escalar
  \begin{equation}\label{eq:R2-divergencia-cartesianas}
    \vvv{\nabla}\cdot\vvv{A}
    = \begin{pmatrix}
      \partial/\partial x & \partial/\partial y      
    \end{pmatrix}
    \begin{pmatrix}
      1 & 0\\
      0 & 1
    \end{pmatrix}
    \begin{pmatrix}
      A_x\\
      A_y
    \end{pmatrix}
    = \dfrac{\partial A_x}{\partial x}
    + \dfrac{\partial A_y}{\partial y}
  \end{equation}
  La divergencia mide la diferencia entre el flujo saliente y el flujo entrante de un
  campo vectorial sobre la superficie que rodea a un volumen de control, por tanto, si el
  campo tiene ''fuentes'' la divergencia será positiva, y si tiene "sumideros", la
  divergencia será negativa. La divergencia mide la rapidez neta con la que se conduce la
  materia al exterior de cada punto, y en el caso de ser la divergencia idénticamente
  igual a cero, describe al flujo incompresible del fluido, llamado también campo
  solenoidal.  
\item La laplaciana de un campo escalar $f(x,y)$ es la divergencia del gradiente y es un
  escalar
  \begin{equation}\label{eq:R2-gradiente-cartesianas}
    \Delta \phi
    =
    \nabla^2 \phi
    = \vvv{\nabla}\cdot\vvv{\nabla}\phi
    = \dfrac{\partial^2 \phi}{\partial x^2}
    + \dfrac{\partial^2 \phi}{\partial y^2}
  \end{equation}
Mide la concentración de un campo en un punto. Si es negativo, indica una tendencia a la
concentración (fuente); si es positivo, indica dispersión.

El operador laplaciano es
\begin{equation}
  \nabla^2
  = \dfrac{\partial^2}{\partial x^2}
  + \dfrac{\partial^2}{\partial y^2}
\end{equation}
\end{itemize}

\subsection{Elemento de área}
El elemento diferencial de área en cartesianas es
\begin{equation}
  d^2a = dx\,dy
\end{equation}
\begin{figure}[ht]
  % Escala
  \def\scl{1}
  %
  \pgfmathsetmacro{\EJESEXTRA}{-0.4}
  \pgfmathsetmacro{\EJESLONG}{2.3}
  % Eje x
  \pgfmathsetmacro{\XMLONG}{\EJESEXTRA}
  \pgfmathsetmacro{\XPLONG}{\EJESLONG}
  % Eje y
  \pgfmathsetmacro{\YMLONG}{\EJESEXTRA}
  \pgfmathsetmacro{\YPLONG}{\EJESLONG}
  % dx, dy
  \pgfmathsetmacro{\LONG}{0.9}
  \pgfmathsetmacro{\DX}{\LONG}
  \pgfmathsetmacro{\DY}{\LONG}
  % Posición del elemento de área
  \pgfmathsetmacro{\PX}{0.5}
  \pgfmathsetmacro{\PY}{1.0}
  % Fondo
  \pgfmathsetmacro{\HORZ}{0.25}
  \pgfmathsetmacro{\VERT}{0.25}
  % 
  \centering
  \begin{tikzpicture}[%
    scale=\scl,
    every node/.style={black,font=\small},
    eje/.style={->},
    proyeccion/.style={black!60, densely dotted},
    area/.style={fill=green!40, draw=black!20},
    %vector/.style={-{Latex[round]}, shorten >=1.2pt, line width=.8pt,\colorV},
    %versor/.style={-{Latex[round, width=4pt, length=8pt]}, line width=1pt, \colorVred},
    textooriginal/.style={\colorTorig},
    %pcirculo/.style={fill=\colorPorig, draw=black},
    %angulogirado/.style={fill=\colorAngGreen, draw=\colorGirodos},
    background/.style={%
      line width=\bgborderwidth,
      draw=\bgbordercolor,
      fill=\bgcolor,
    },
    ]
    % COORDENADAS
    % Origen
    \coordinate (O) at (0,0);
    % Extremo izdo del eje x e inferior del eje y
    \coordinate (xini) at (\XMLONG cm,0);
    \coordinate (yini) at (0,\YMLONG cm);
    % Eje x
    \path[save path=\ejex] (xini) -- (\XPLONG cm, 0) coordinate (xfin);
    % Eje y
    \path[save path=\ejey] (yini) -- (0, \YPLONG cm) coordinate (yfin);
    % Punto P
    \coordinate (P) at (\PX, \PY);
    %
    \path (P) -- coordinate[pos=0.5] (dxtext) ++(\DX, 0) coordinate (PDX);
    \path (P) -- coordinate[pos=0.5] (dytext) ++(0, \DY) coordinate (PDY);
%    % Vector
%    \path[save path=\vector] (O) -- coordinate[pos=0.5] (pmid) (\PANG:\PMOD cm)
%    coordinate (P);
%    % Proyección de elemento de área en los ejes
    \path[save path=\proyPx] (P) |- coordinate (Px) (xfin);
    \path[save path=\proyPy] (P) -| coordinate (Py) (yfin);
    \path[save path=\proyPhorx] (PDX) |- coordinate (Phorx) (xfin);
    \path[save path=\proyPverty] (PDY) -| coordinate (Pverty) (yfin);
    % Texto de las proyecciones en los ejes
    \path (Px) -- coordinate[pos=0.5] (dxtexto) (Phorx);
    \path (Py) -- coordinate[pos=0.5] (dytexto) (Pverty);
    
    % DIBUJOS
    % Proyección de elemento de área en los ejes
    \draw[proyeccion, use path=\proyPx];
    \draw[proyeccion, use path=\proyPy];
    \draw[proyeccion, use path=\proyPhorx];
    \draw[proyeccion, use path=\proyPverty];
    % Texto dx y dy en los ejes
    \node[below] at (dxtexto) {$dx$};
    \node[left] at (dytexto) {$dy$};
    
    % Ejes
    % x
    \draw[eje, use path=\ejex];
    \node[right] at (xfin) {$x$};
    %\node[below] at (xtexto) {$x$};
    % y
    \draw[eje, use path=\ejey];
    \node[above] at (yfin) {$y$};
    % \node[left] at (ytexto) {$y$};
    % Punto P
    % \fill (P) circle[radius=1.2pt];
    % Elemento de área
    \filldraw[area] (P) rectangle coordinate (centro) ++(\DX, \DY);
    \node at (centro) {\footnotesize $d^2a$};

    % Origen
    \filldraw (O) circle [radius=.2pt];

    % Fondo amarillo
    \coordinate (SW) at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
    \coordinate (NE) at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);    
    \begin{scope}[on background layer]
      \draw[background] (SW) rectangle (NE);
    \end{scope}
  \end{tikzpicture}
  \caption{Elemento de área en coordenadas cartesianas, $d^2a = dx dy$.}
  \label{fig:R2-cartesianas-elemento_area}
\end{figure}

Este elemento se relaciona trivialmente con el jacobiano de la
\emph{transformación identidad} $f(x,y) \longrightarrow f(x,y)$
\[
  d^2a = \dfrac{\partial(x,y)}{\partial(x,y)} dx dy
  = \begin{vmatrix}
    \partial x/\partial x & \partial x/\partial y\\
    \partial y/\partial x & \partial y/\partial y
  \end{vmatrix}
  dx dy
  = \begin{vmatrix}
    1 & 0\\
    0 & 1
  \end{vmatrix}
  dx dy
  = 1\,dx dy
  = dxdy
\]

\section{Coordenadas cartesianas oblícuas}

\begin{figure}[ht]
  \centering
  % Escala
  \def\scl{1.00}
  % 
  \pgfmathsetmacro{\EJESCARTLONG}{2.3}
  \pgfmathsetmacro{\EJEOBLICLONG}{2.0}
  % Eje x
  \pgfmathsetmacro{\XLONG}{\EJESCARTLONG}
    % Eje y
    \pgfmathsetmacro{\YLONG}{\EJESCARTLONG}
    % Eje xtilde
    \pgfmathsetmacro{\XTILDEANG}{0}
    \pgfmathsetmacro{\XTILDELONG}{\EJESCARTLONG}    
    % Eje ytilde
    \pgfmathsetmacro{\YTILDEANG}{60}
    \pgfmathsetmacro{\YTILDELONG}{\EJESCARTLONG}
    % Versores
    \pgfmathsetmacro{\VTILDEMOD}{1.4}
    \pgfmathsetmacro{\VXTILDEANG}{0}
    \pgfmathsetmacro{\VYTILDEANG}{\YTILDEANG}   
    % Vector P
    \pgfmathsetmacro{\PMOD}{2.5}
    \pgfmathsetmacro{\PANG}{40}
    % Fondo
    \pgfmathsetmacro{\HORZ}{0.25}
    \pgfmathsetmacro{\VERT}{0.25}
    % 
    \centering
    \begin{tikzpicture}[%
      scale=\scl,
      every node/.style={black,font=\small},
      ejecart/.style={->, black!30},
      ejeoblic/.style={->, black},
      proyeccion/.style={black!60, densely dotted},
      %longitud/.style={line width=.5pt,\colorV},
      texto/.style={black},
      textoapagado/.style={\colorTorig},
      vtilde/.style={%
        -{Latex[round,width=4pt,length=6pt]}, line width=1pt, \colorVred},
      pcirculo/.style={fill=\colorPorig, draw=black},
      angulo/.style={draw=\colorGirodos},
      background/.style={%
        line width=\bgborderwidth,
        draw=\bgbordercolor,
        fill=\bgcolor,
      },
      ]
      % COORDENADAS
      % Origen
      \coordinate (O) at (0,0);
      % Eje x
      \path[save path=\ejex] (O) -- (\XLONG cm, 0) coordinate (xfin);
      % Eje y
      \path[save path=\ejey] (O) -- (0, \YLONG cm) coordinate (yfin);
      % Eje xtilde
      \path[save path=\ejextilde] (O) -- ++(\XTILDEANG:\XTILDELONG cm)
      coordinate (xtildefin);
      % Eje ytilde
      \path[save path=\ejeytilde] (O) -- ++(\YTILDEANG:\YTILDELONG cm)
      coordinate (ytildefin);
      % Versores tilde
      \path[save path=\vxtilde] (O) -- coordinate[pos=1.0] (vxtildetxt)
      ++(\VXTILDEANG:\VTILDEMOD cm);
      \path[save path=\vytilde] (O) -- coordinate[pos=1.1] (vytildetxt)
      ++(\VYTILDEANG:\VTILDEMOD cm) coordinate (e2fin);
      % Vector
      %\path[save path=\r] (O) -- coordinate[pos=0.5] (pmid) (\PANG:\PMOD cm)
      %coordinate (P);
      % Proyección de P en los ejes
      \path[save path=\proyx] (e2fin) |- (xfin);
      \path[save path=\proyy] (e2fin) -| (yfin);

      % DIBUJOS
      % Ángulo theta
      \path (xfin) -- (O) -- (ytildefin) pic
      [angulo, "\footnotesize $\alpha$",angle radius=12pt, angle eccentricity=0.68]
      {angle = xfin--O--ytildefin};
      % Proyección de etilde2 en los ejes
      \draw[proyeccion, use path=\proyx];
      \draw[proyeccion, use path=\proyy];
      % Ejes
      % x
      \draw[ejecart, use path=\ejex];
      \node[textoapagado, below] at (xfin) {$x,\color{black}{\tilde{x}^1}$};
      %\node[below] at (xtexto) {$r\cos\theta$};
      % y
      \draw[ejecart, use path=\ejey];
      \node[above, textoapagado] at (yfin) {$y$};
      % xtilde
      \draw[ejeoblic, use path=\ejextilde];
      %\node[below, texto] at (xtildefin) {$\tilde{x}^1$};
      % ytilde
      \draw[ejeoblic, use path=\ejeytilde];
      \node[above right=0pt and -4pt, texto] at (ytildefin) {$\tilde{x}^2$};
      % \node[rotate=90, left=8pt] at (ytexto) {$r\sin\theta$};
      % Versores
      \draw[vtilde, use path=\vxtilde];
      \node[\colorTred, below] at (vxtildetxt) {\footnotesize $\xtilde{e}_1$};
      \draw[vtilde, use path=\vytilde];
      \node[\colorTred,left=2pt] at (vytildetxt) {\footnotesize $\xtilde{e}_2$};
%      % Coordenada r y punto  P
%      \draw[longitud, use path=\r];
%      \node[above left=-3pt and -1pt] at (pmid) {$r$};
%      \filldraw[fill=green, draw=black] (P) circle[radius=1.2pt];
%      \node[above] at (P) {$P$};

      % Origen
      \filldraw (O) circle [radius=.2pt];
      
      % Fondo amarillo
      \coordinate (SW) at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
      \coordinate (NE) at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);
      \begin{scope}[on background layer]
        \draw[background] (SW) rectangle (NE);
      \end{scope}
    \end{tikzpicture}
    \caption{Sistema de coordenadas cartesianas oblícuas que forman un ángulo $\alpha$.
      También se representan los ejes cartesianos tradicionales como referencia.
      Por último se aprecian en rojo los vectores unitarios del sistema oblícuo.}
  %\label{fig:R2-coordenadas-R2}
\end{figure}

%\begin{figure}[ht]
%  \centering
%  \begin{minipage}{0.40\linewidth}
%    % Escala
%    \def\scl{1.00}
%    % 
%    \pgfmathsetmacro{\EJESCARTLONG}{2.3}
%    \pgfmathsetmacro{\EJEOBLICLONG}{2.0}
%    % Eje x
%    \pgfmathsetmacro{\XLONG}{\EJESCARTLONG}
%    % Eje y
%    \pgfmathsetmacro{\YLONG}{\EJESCARTLONG}
%    % Eje xtilde
%    \pgfmathsetmacro{\XTILDEANG}{0}
%    \pgfmathsetmacro{\XTILDELONG}{\EJESCARTLONG}    
%    % Eje ytilde
%    \pgfmathsetmacro{\YTILDEANG}{70}
%    \pgfmathsetmacro{\YTILDELONG}{\EJESCARTLONG}
%    % Vector P
%    \pgfmathsetmacro{\PMOD}{2.5}
%    \pgfmathsetmacro{\PANG}{40}
%    % Fondo
%    \pgfmathsetmacro{\HORZ}{0.25}
%    \pgfmathsetmacro{\VERT}{0.25}
%    % 
%    \centering
%    \begin{tikzpicture}[%
%      scale=\scl,
%      every node/.style={black,font=\small},
%      ejecart/.style={->, black!30},
%      ejeoblic/.style={->, black},
%      proyeccion/.style={black!60, densely dotted},
%      %longitud/.style={line width=.5pt,\colorV},
%      texto/.style={black!80},
%      textoapagado/.style={\colorTorig},
%      pcirculo/.style={fill=\colorPorig, draw=black},
%      %angulogirado/.style={fill=\colorAngGreen, draw=\colorGirodos},
%      background/.style={%
%        line width=\bgborderwidth,
%        draw=\bgbordercolor,
%        fill=\bgcolor,
%      },
%      ]
%      % COORDENADAS
%      % Origen
%      \coordinate (O) at (0,0);
%      % Eje x
%      \path[save path=\ejex] (O) -- (\XLONG cm, 0) coordinate (xfin);
%      % Eje y
%      \path[save path=\ejey] (O) -- (0, \YLONG cm) coordinate (yfin);
%      % Eje xtilde
%      \path[save path=\ejextilde] (O) -- ++(\XTILDEANG:\XTILDELONG cm)
%      coordinate (xtildefin);
%      % Eje ytilde
%      \path[save path=\ejeytilde] (O) -- ++(\YTILDEANG:\YTILDELONG cm)
%      coordinate (ytildefin);
%      % Vector
%      %\path[save path=\r] (O) -- coordinate[pos=0.5] (pmid) (\PANG:\PMOD cm)
%      %coordinate (P);
%      % Proyección de P en los ejes
%      \path[save path=\proyx] (P) |- (xfin);
%      \path[save path=\proyy] (P) -| (yfin);
%
%      % DIBUJOS
%%      % Ángulo theta
%%      \path (xfin) -- (O) -- (P) pic
%%      [-{Latex[width=2.5pt,length=3.7pt]},angulogirado,
%%      "\footnotesize $\theta$",angle radius=20pt, angle eccentricity=0.68]
%%      {angle = xfin--O--P};
%%      % Proyección de P en los ejes
%%      \draw[proyeccion, use path=\proyx];
%%      \draw[proyeccion, use path=\proyy];
%      % Ejes
%      % x
%      \draw[ejecart, use path=\ejex];
%      \node[textoapagado, right] at (xfin) {$x$};
%      %\node[below] at (xtexto) {$r\cos\theta$};
%      % y
%      \draw[ejecart, use path=\ejey];
%      \node[above, textoapagado] at (yfin) {$y$};
%      % xtilde
%      \draw[ejeoblic, use path=\ejextilde];
%      \node[below, texto] at (xtildefin) {$\tilde{x}^1$};
%      % ytilde
%      \draw[ejeoblic, use path=\ejeytilde];
%      \node[above right=0pt and -4pt, texto] at (ytildefin) {$\tilde{x}^2$};
%      %\node[rotate=90, left=8pt] at (ytexto) {$r\sin\theta$};
%%      % Coordenada r y punto  P
%%      \draw[longitud, use path=\r];
%%      \node[above left=-3pt and -1pt] at (pmid) {$r$};
%%      \filldraw[fill=green, draw=black] (P) circle[radius=1.2pt];
%%      \node[above] at (P) {$P$};
%
%      % Origen
%      \filldraw (O) circle [radius=.2pt];
%      
%%      % Fondo amarillo
%%      \coordinate (SW) at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
%%      \coordinate (NE) at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);
%%      \begin{scope}[on background layer]
%%        \draw[background] (SW) rectangle (NE);
%%      \end{scope}
%    \end{tikzpicture}
%  \caption{Coordenadas polares $r$ y $\theta$ de un punto $P$ del plano.}
%  %\label{fig:R2-coordenadas-R2}
%\end{minipage}
%\hspace{1em}
%\begin{minipage}{0.40\linewidth}
%    % Escala
%    \def\scl{1.20}
%    % 
%    \pgfmathsetmacro{\EJESEXTRA}{-0.2}
%    \pgfmathsetmacro{\EJESLONG}{2.3}
%    % Eje x
%    \pgfmathsetmacro{\XMLONG}{\EJESEXTRA}
%    \pgfmathsetmacro{\XPLONG}{\EJESLONG}
%    % Eje y
%    \pgfmathsetmacro{\YMLONG}{\EJESEXTRA}
%    \pgfmathsetmacro{\YPLONG}{\EJESLONG}
%    % Vector P
%    \pgfmathsetmacro{\PMOD}{2.5}
%    \pgfmathsetmacro{\PANG}{40}
%    % Fondo
%    \pgfmathsetmacro{\HORZ}{0.25}
%    \pgfmathsetmacro{\VERT}{0.25}
%    % 
%    \centering
%    \begin{tikzpicture}[%
%      scale=\scl,
%      every node/.style={black,font=\small},
%      eje/.style={->},
%      proyeccion/.style={black!60, densely dotted},
%      vector/.style={-{Latex[round]}, shorten >=1.2pt, line width=.8pt,\colorV},
%      textooriginal/.style={\colorTorig},
%      pcirculo/.style={fill=\colorPorig, draw=black},
%      angulogirado/.style={fill=\colorAngGreen, draw=\colorGirodos},
%      background/.style={%
%        line width=\bgborderwidth,
%        draw=\bgbordercolor,
%        fill=\bgcolor,
%      },
%      ]
%      % COORDENADAS
%      % Origen
%      \coordinate (O) at (0,0);
%      % Extremo izdo del eje x e inferior del eje y
%      \coordinate (xini) at (\XMLONG cm,0);
%      \coordinate (yini) at (0,\YMLONG cm);
%      % Eje x
%      \path[save path=\ejex] (xini) -- coordinate[pos=0.5] (xtexto) (\XPLONG cm, 0)
%      coordinate (xfin);
%      % Eje y
%      \path[save path=\ejey] (yini) -- coordinate[pos=0.6] (ytexto) (0, \YPLONG cm)
%      coordinate (yfin);
%      % Vector
%      \path[save path=\vector] (O) -- coordinate[pos=0.5] (pmid) (\PANG:\PMOD cm)
%      coordinate (P);
%      % Proyección de P en los ejes
%      \path[save path=\proyx] (P) |- (xfin);
%      \path[save path=\proyy] (P) -| (yfin);
%
%      % DIBUJOS
%      % Ángulo theta
%      \path (xfin) -- (O) -- (P) pic
%      [-{Latex[width=2.5pt,length=3.7pt]},angulogirado,
%      "\footnotesize $\theta$",angle radius=20pt, angle eccentricity=0.68]
%      {angle = xfin--O--P};
%      % Proyección de P en los ejes
%      \draw[proyeccion, use path=\proyx];
%      \draw[proyeccion, use path=\proyy];
%      % Ejes
%      % x
%      \draw[eje, use path=\ejex];
%      \node[right] at (xfin) {$x$};
%      \node[below] at (xtexto) {$r\cos\theta$};
%      % y
%      \draw[eje, use path=\ejey];
%      \node[above] at (yfin) {$y$};
%      \node[rotate=90, left=8pt] at (ytexto) {$r\sin\theta$};
%      % Vector y punto  P
%      \draw[vector, use path=\vector];
%      \node[above left=-3pt and -1pt] at (pmid) {$\vvv{r}$};
%      \filldraw[fill=green, draw=black] (P) circle[radius=1.2pt];
%      \node[above] at (P) {$P$};
%
%      % Origen
%      \filldraw (O) circle [radius=.2pt];
%      % Fondo amarillo
%      \coordinate (SW) at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
%      \coordinate (NE) at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);
%      \begin{scope}[on background layer]
%        \draw[background] (SW) rectangle (NE);
%      \end{scope}
%    \end{tikzpicture}
%    \caption{Vector de posición $\vvv{r}$, y coordenadas $x$ e $y$ en función de $r$ y
%      $\theta$.}
%  %\label{fig:R2:vector-r-R2}
%\end{minipage}
%\end{figure}



\section{Coordenadas polares planas}
Aquí se ponen las cosas algo más interesantes. En este sistema, se utilizan dos
coordenadas, $r$ y $\theta$. La primera coordenada es la distancia desde el punto del espacio al origen de coordenadas, y la segunda es el ángulo que forma el eje de abcisas
con la línea que une el origen de coordenadas con el punto, ver figura
\ref{fig:R2-coordenadas-R2}.

\begin{figure}[ht]
  \centering
  \begin{minipage}{0.40\linewidth}
    % Escala
    \def\scl{1.25}
    % 
    \pgfmathsetmacro{\EJESEXTRA}{-0.2}
    \pgfmathsetmacro{\EJESLONG}{2.3}
    % Eje x
    \pgfmathsetmacro{\XMLONG}{\EJESEXTRA}
    \pgfmathsetmacro{\XPLONG}{\EJESLONG}
    % Eje y
    \pgfmathsetmacro{\YMLONG}{\EJESEXTRA}
    \pgfmathsetmacro{\YPLONG}{\EJESLONG}
    % Vector P
    \pgfmathsetmacro{\PMOD}{2.5}
    \pgfmathsetmacro{\PANG}{40}
    % Fondo
    \pgfmathsetmacro{\HORZ}{0.25}
    \pgfmathsetmacro{\VERT}{0.25}
    % 
    \centering
    \begin{tikzpicture}[%
      scale=\scl,
      every node/.style={black,font=\small},
      eje/.style={->},
      proyeccion/.style={black!60, densely dotted},
      longitud/.style={line width=.5pt,\colorV},
      textooriginal/.style={\colorTorig},
      pcirculo/.style={fill=\colorPorig, draw=black},
      angulogirado/.style={fill=\colorAngGreen, draw=\colorGirodos},
      background/.style={%
        line width=\bgborderwidth,
        draw=\bgbordercolor,
        fill=\bgcolor,
      },
      ]
      % COORDENADAS
      % Origen
      \coordinate (O) at (0,0);
      % Extremo izdo del eje x e inferior del eje y
      \coordinate (xini) at (\XMLONG cm,0);
      \coordinate (yini) at (0,\YMLONG cm);
      % Eje x
      \path[save path=\ejex] (xini) -- coordinate[pos=0.5] (xtexto) (\XPLONG cm, 0)
      coordinate (xfin);
      % Eje y
      \path[save path=\ejey] (yini) -- coordinate[pos=0.6] (ytexto) (0, \YPLONG cm)
      coordinate (yfin);
      % Vector
      \path[save path=\r] (O) -- coordinate[pos=0.5] (pmid) (\PANG:\PMOD cm)
      coordinate (P);
      % Proyección de P en los ejes
      \path[save path=\proyx] (P) |- (xfin);
      \path[save path=\proyy] (P) -| (yfin);

      % DIBUJOS
      % Ángulo theta
      \path (xfin) -- (O) -- (P) pic
      [-{Latex[width=2.5pt,length=3.7pt]},angulogirado,
      "\footnotesize $\theta$",angle radius=20pt, angle eccentricity=0.68]
      {angle = xfin--O--P};
      % Proyección de P en los ejes
      \draw[proyeccion, use path=\proyx];
      \draw[proyeccion, use path=\proyy];
      % Ejes
      % x
      \draw[eje, use path=\ejex];
      \node[right] at (xfin) {$x$};
      %\node[below] at (xtexto) {$r\cos\theta$};
      % y
      \draw[eje, use path=\ejey];
      \node[above] at (yfin) {$y$};
      %\node[rotate=90, left=8pt] at (ytexto) {$r\sin\theta$};
      % Coordenada r y punto  P
      \draw[longitud, use path=\r];
      \node[above left=-3pt and -1pt] at (pmid) {$r$};
      \filldraw[fill=green, draw=black] (P) circle[radius=1.2pt];
      \node[above] at (P) {$P$};

      % Origen
      \filldraw (O) circle [radius=.2pt];
      % Fondo amarillo
      \coordinate (SW) at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
      \coordinate (NE) at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);
      \begin{scope}[on background layer]
        \draw[background] (SW) rectangle (NE);
      \end{scope}
    \end{tikzpicture}
  \caption{Coordenadas polares $r$ y $\theta$ de un punto $P$ del plano.}
  \label{fig:R2-coordenadas-R2}
\end{minipage}
\hspace{1em}
\begin{minipage}{0.40\linewidth}
    % Escala
    \def\scl{1.20}
    % 
    \pgfmathsetmacro{\EJESEXTRA}{-0.2}
    \pgfmathsetmacro{\EJESLONG}{2.3}
    % Eje x
    \pgfmathsetmacro{\XMLONG}{\EJESEXTRA}
    \pgfmathsetmacro{\XPLONG}{\EJESLONG}
    % Eje y
    \pgfmathsetmacro{\YMLONG}{\EJESEXTRA}
    \pgfmathsetmacro{\YPLONG}{\EJESLONG}
    % Vector P
    \pgfmathsetmacro{\PMOD}{2.5}
    \pgfmathsetmacro{\PANG}{40}
    % Fondo
    \pgfmathsetmacro{\HORZ}{0.25}
    \pgfmathsetmacro{\VERT}{0.25}
    % 
    \centering
    \begin{tikzpicture}[%
      scale=\scl,
      every node/.style={black,font=\small},
      eje/.style={->},
      proyeccion/.style={black!60, densely dotted},
      vector/.style={-{Latex[round]}, shorten >=1.2pt, line width=.8pt,\colorV},
      textooriginal/.style={\colorTorig},
      pcirculo/.style={fill=\colorPorig, draw=black},
      angulogirado/.style={fill=\colorAngGreen, draw=\colorGirodos},
      background/.style={%
        line width=\bgborderwidth,
        draw=\bgbordercolor,
        fill=\bgcolor,
      },
      ]
      % COORDENADAS
      % Origen
      \coordinate (O) at (0,0);
      % Extremo izdo del eje x e inferior del eje y
      \coordinate (xini) at (\XMLONG cm,0);
      \coordinate (yini) at (0,\YMLONG cm);
      % Eje x
      \path[save path=\ejex] (xini) -- coordinate[pos=0.5] (xtexto) (\XPLONG cm, 0)
      coordinate (xfin);
      % Eje y
      \path[save path=\ejey] (yini) -- coordinate[pos=0.6] (ytexto) (0, \YPLONG cm)
      coordinate (yfin);
      % Vector
      \path[save path=\vector] (O) -- coordinate[pos=0.5] (pmid) (\PANG:\PMOD cm)
      coordinate (P);
      % Proyección de P en los ejes
      \path[save path=\proyx] (P) |- (xfin);
      \path[save path=\proyy] (P) -| (yfin);

      % DIBUJOS
      % Ángulo theta
      \path (xfin) -- (O) -- (P) pic
      [-{Latex[width=2.5pt,length=3.7pt]},angulogirado,
      "\footnotesize $\theta$",angle radius=20pt, angle eccentricity=0.68]
      {angle = xfin--O--P};
      % Proyección de P en los ejes
      \draw[proyeccion, use path=\proyx];
      \draw[proyeccion, use path=\proyy];
      % Ejes
      % x
      \draw[eje, use path=\ejex];
      \node[right] at (xfin) {$x$};
      \node[below] at (xtexto) {$r\cos\theta$};
      % y
      \draw[eje, use path=\ejey];
      \node[above] at (yfin) {$y$};
      \node[rotate=90, left=8pt] at (ytexto) {$r\sin\theta$};
      % Vector y punto  P
      \draw[vector, use path=\vector];
      \node[above left=-3pt and -1pt] at (pmid) {$\vvv{r}$};
      \filldraw[fill=green, draw=black] (P) circle[radius=1.2pt];
      \node[above] at (P) {$P$};

      % Origen
      \filldraw (O) circle [radius=.2pt];
      % Fondo amarillo
      \coordinate (SW) at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
      \coordinate (NE) at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);
      \begin{scope}[on background layer]
        \draw[background] (SW) rectangle (NE);
      \end{scope}
    \end{tikzpicture}
    \caption{Vector de posición $\vvv{r}$, y coordenadas $x$ e $y$ en función de $r$ y
      $\theta$.}
  \label{fig:R2:vector-r-R2}
\end{minipage}
\end{figure}

\subsection{Relación con las coordenadas cartesianas}
De la figura \ref{fig:R2:vector-r-R2} se desprenden las siguientes relaciones
\begin{subequations}
  \begin{align}\label{eq:R2-x-rtheta}
    x &= r\cos\theta\\
    \label{eq:R2-y-rtheta}
    y &= r\sin\theta
  \end{align}
\end{subequations}
y sus inversas
\begin{subequations}
  \begin{align}\label{eq:R2-r-xy}
    r &= \sqrt{x^2 + y^2}\\
    \label{eq:R2-theta-xy}
    \theta &= \arctan\left(\frac{y}{x}\right)
  \end{align}
\end{subequations}
Nótese que el ángulo $\theta$ no está definido en el origen. Por eso en este sistema el
origen es un polo (las coordenadas no están completamente definidas).

\subsection{Bases, vectores unitarios, sus productos escalares y derivadas}
El vector $\vvv{r}$ que representa cualquier punto de $\symbb{R}^2$ se puede escribir, en
la base natural de coordenadas cartesianas, como
\begin{equation}
  \vvv{r} = r\cos\theta\,\uvec{\i} + r\sin\theta\,\uvec{\j}
\end{equation}
\subsubsection{Derivadas parciales de la posición}
La base natural en polares está formada por los vectores
$B = \{\vvv{e}_r, \vvv{e}_{\theta}\}$ ---no necesariamente unitarios--- que llevan
información del cambio de posición al variar cada coordenada forman una base
$\set{\vvv{e}_r, \vvv{e}_\theta}$ y se calculan derivando parcialmente el vector
$\vvv{r}$ con respecto de las variables $r$ y $\theta$
\begin{subequations}
\begin{align}
  \vvv{e}_r
  &=
    \dfrac{\partial\vvv{r}}{\partial r}
    = \cos\theta\,\uvec{\i} + \sin\theta\,\uvec{\j}
    \longrightarrow
    \|\vvv{e}_r\| = 1\\
  \vvv{e}_\theta
  &=
    \dfrac{\partial\vvv{r}}{\partial\theta}
    = -r\sin\theta\,\uvec{\i} + r\cos\theta\,\uvec{\j}
    \longrightarrow
    \|\vvv{e}_\theta\| = r\\    
\end{align}
\end{subequations}
Estos vectores se utilizan en geometría diferencial y son los que se utilizarán para
calcular la métrica en coordenadas polares. Nótese que, en particular, $\vvv{e}_\theta$ no
es un vector unitario, su módulo vale $r$.

\subsubsection{Vectores unitarios}
En física estamos interesados en bases unitarias. La base unitaria en polares la
representaremos como $B=\set{\xhat{r}, \xhat{\theta}}$.
Calculamos los vectores unitarios en polares en función de la base cartesiana
{\small
\begin{subequations}
  \begin{align}\label{eq:R2-versor-r}
    \xhat{r}
    &= \dfrac{\vvv{e}_r}{|\vvv{e}_r|}
    =\dfrac{\cos\theta\,\uvec{\i}+\sin\theta\,\uvec{\j}}
    {\sqrt{\cos^2\theta+\sin^2\theta}}
    = \dfrac{\cos\theta\,\uvec{\i}+\sin\theta\,\uvec{\j}}{1}
      = \cos\theta\,\uvec{\i} + \sin\theta\,\uvec{\j}\\
    \label{eq:R2-versor-theta}
  \xhat{\theta}
  &= \dfrac{\vvv{e}_\theta}{|\vvv{e}_\theta|}
  = \dfrac{-r\sin\theta\,\uvec{\i}+\cos\theta\,\uvec{\j}}
  {\sqrt{r^2(\cos^2\theta+\sin^2\theta)}}
  = \dfrac{-r\sin\theta\,\uvec{\i}+r\cos\theta\,\uvec{\j}}{r}
  = -\sin\theta\,\uvec{\i} + \cos\theta\,\uvec{\j}
  \end{align}
\end{subequations}
}
Resumimos este cambio de base y su inversa en forma matricial
\begin{subequations}
\begin{align}
  \begin{pmatrix}
    \xhat{r}\\
    \xhat{\theta}
  \end{pmatrix}
  &=
  \begin{pmatrix}
    \cos\theta & \sin\theta\\
    -\sin\theta & \cos\theta
  \end{pmatrix}
  \,
  \begin{pmatrix}
    \uvec{\i}\\
    \uvec{\j}
  \end{pmatrix}\\
\begin{pmatrix}
    \uvec{\i}\\
    \uvec{\j}
  \end{pmatrix}
  &=
  \begin{pmatrix}
    \cos\theta & -\sin\theta\\
    \sin\theta & \cos\theta
  \end{pmatrix}
  \,
  \begin{pmatrix}
    \xhat{r}\\
    \xhat{\theta}
  \end{pmatrix} 
\end{align}
\end{subequations}
donde se ha utilizado la inversa de la matriz de cambio de base, que por ser ortogonal,
la inversa es su transpuesta.

Nótese que los vectores de la base natural $\vvv{e}_r$ y $\vvv{e}_\theta$ se pueden
escribir en función de los unitarios como
\begin{subequations}
\begin{align}
  \vvv{e}_r &= \xhat{r}\\
  \vvv{e}_\theta &= r\xhat{\theta}
\end{align}
\end{subequations}

\subsubsection{Productos escalares}
\begin{itemize}
\item De los vectores unitarios
{\small
\begin{subequations}
  \begin{align}
    \xhat{r}\cdot\xhat{r}
    &=
      (\cos\theta\,\uvec{\i}+\sin\theta\,\uvec{\j})
      \cdot
      (\cos\theta\,\uvec{\i}+\sin\theta\,\uvec{\j})
      = \cos^2\theta + \sin^2\theta = 1\\
    \xhat{r}\cdot\xhat{\theta}
    &=
      \xhat{\theta}\cdot\xhat{r}
      = (\cos\theta\,\uvec{\i}+\sin\theta\,\uvec{\j})
      \cdot
      (-\sin\theta\,\uvec{\i}+\cos\theta\,\uvec{\j})
      = -\sin\theta\cos\theta + \sin\theta\cos\theta = 0\\
    \xhat{\theta}\cdot\xhat{\theta}
    &=
      (-\sin\theta\,\uvec{\i}+\cos\theta\,\uvec{\j})
      \cdot
      (-\sin\theta\,\uvec{\i}+\cos\theta\,\uvec{\j})
      = \sin^2\theta + \cos^2\theta = 1
  \end{align}
\end{subequations}
}

\item De los vectores $\vvv{e}_r$ y $\vvv{e}_\theta$
\begin{subequations}
  \begin{align}\label{eq:R2-erer-productoescalar}
    \vvv{e}_r\cdot\vvv{e}_r
    &=
      \xhat{r}\cdot\vvv{r} = 1\\
    \label{eq:R2-eretheta-productoescalar}
    \vvv{e}_r\cdot\vvv{e}_\theta
    &=
      \vvv{e}_\theta\cdot\vvv{e}_r
      = \xhat{r}\cdot r\xhat{\theta} = r \xhat{r}\cdot\xhat{\theta} = 0\\
    \label{eq:R2-ethetaetheta-productoescalar}
    \vvv{e}_r\cdot\vvv{e}_\theta
    &=
      \vvv{e}_\theta\cdot\vvv{e}_\theta
      = r\xhat{\theta}\cdot r\xhat{\theta}
      = r^2 \xhat{\theta}\cdot\xhat{\theta} = r^2\\    
  \end{align}
\end{subequations}
\end{itemize}

\subsubsection{Derivadas de los vectores unitarios}
Para terminar, nos interesan las derivadas de los vectores $\xhat{r}$ y $\xhat{\theta}$
con respecto de $r$
\begin{subequations}
\begin{align}\label{eq:R2-partial-versor_r-r}
  \dfrac{\partial\xhat{r}}{\partial r}
  &=
  \dfrac{\partial}{\partial r}(\cos\theta\,\uvec{\i}+\sin\theta\,\uvec{\j})
  = 0\\
  \label{eq:R2-partial-versor_theta-r}
  \dfrac{\partial\xhat{\theta}}{\partial r}
  &=
  \dfrac{\partial}{\partial r}(-\sin\theta\,\uvec{\i}+\cos\theta\,\uvec{\j})
  = 0
\end{align}
\end{subequations}
Derivadas con respecto de $\theta$
\begin{subequations}
\begin{align}\label{eq:R2-partial-versor_r-theta}
  \dfrac{\partial\xhat{r}}{\partial\theta}
  &=
  \dfrac{\partial}{\partial r}(\cos\theta\,\uvec{\i}+\sin\theta\,\uvec{\j})  
  = -\sin\theta\,\uvec{\i} + \cos\theta\,\uvec{\j} = \xhat{\theta}\\
  \label{eq:R2-partial-versor_theta-theta}
  \dfrac{\partial\xhat{\theta}}{\partial\theta}
  &=
  \dfrac{\partial}{\partial r}(-\sin\theta\,\uvec{\i}+\cos\theta\,\uvec{\j})  
  = -\cos\theta\,\uvec{\i} - \sin\theta\,\uvec{\j} = -\xhat{r}
\end{align}
\end{subequations}

\subsection{Métrica y factores de escala}
Vamos a calcular la métrica y los factores de escala de varias formas:
\begin{enumerate}
\item Directamente, utilizando los productos escalares
  \eqref{eq:R2-erer-productoescalar}, \eqref{eq:R2-eretheta-productoescalar} y
   \eqref{eq:R2-ethetaetheta-productoescalar}
  \begin{equation}\label{eq:R2-metrica-polares}
    \mmm{g}
    = g_{ij}
    = \begin{pmatrix}
      g_{11} & g_{12}\\
      g_{21} & g_{22}
      \end{pmatrix}
    = \begin{pmatrix}
      \vvv{e}_r\cdot\vvv{e}_r & \vvv{e}_r\cdot\vvv{e}_\theta\\
      \vvv{e}_\theta\cdot\vvv{e}_r & \vvv{e}_\theta\cdot\vvv{e}_\theta
    \end{pmatrix}
    = \begin{pmatrix}
      1 & 0\\
      0 & r^2
    \end{pmatrix}
  \end{equation}
  
\item Empezamos calculando las diferenciales $dx$ y $dy$
  \begin{subequations}
    \begin{align}\label{eq:R2-dx}
      dx
      &=
        \dfrac{\partial x}{\partial r} dr + \dfrac{\partial x}{\partial\theta} d\theta
        = \cos\theta dr - r\sin\theta d\theta\\
      \label{eq:R2-dy}
      dy
      &=
        \dfrac{\partial y}{\partial r} dr + \dfrac{\partial y}{\partial\theta} d\theta
        = \sin\theta dr + r\cos\theta d\theta
    \end{align}
  \end{subequations}

La métrica se puede deducir a partir del cuadrado de la distancia recorrida en el
espacio al cambiar las coordenadas
{\footnotesize
  \begin{align*}
    ds^2
    &=
      dx^2 + dy^2
      = (\cos\theta dr - r\sin\theta d\theta)^2
      + (\sin\theta dr + r\cos\theta d\theta)^2\\
    &=
      \cos^2\theta dr^2
      + \!r^2\sin^2\theta d\theta^2
      - \!\cancelout{2r\sin\theta \cos\theta dr d\theta}
      + \!\sin^2\theta dr^2
      + \!r^2 \cos^2\theta d\theta^2
      + \!\cancelout{2r\sin\theta \cos\theta dr d\theta}\\
    &=
      (\cos^2\theta + \sin^2\theta) dr^2 + r^2(\sin^2\theta + \cos^2\theta) d\theta^2
      = dr^2 + r^2 d\theta^2
  \end{align*}
}
donde se han tenido en cuenta las ecuaciones~\eqref{eq:R2-dx} y ~\eqref{eq:R2-dy} y que
los vectores unitarios $\xhat{r}$ y $\xhat{\theta}$ son ortogonales.

\item De forma intuitiva podemos interpretar la métrica. Veamos
  \begin{itemize}
  \item Las variables $r$ y $\theta$ son ortogonales, un cambio en una de ellas no afecta
    a la otra, como se puede comprobar observando las figuras
    \ref{fig:R2-polares-intuicion-h-r} y \ref{fig:R2-polares-intuicion-h-theta}.
    De esta manera, vemos que los elementos no diagonales de la métrica valen cero,
    $g_{12}=g_{21}=0$.
  \item Por otro lado, en la figura \ref{fig:R2-polares-intuicion-h-r} observamos que
    cuando modificamos la variable $r$ en una cierta distancia $\Delta r$, estamos
    desplazándonos en el espacio la misma distancia $\Delta s$. esto significa que
    el coeficiente de escala $h_r$ vale la unidad. Esto implica que el elemento
    $g_{11}$ de la métrica vale lo mismo.
    \begin{subequations}
      \begin{align}
        h_r
        &=
          \dfrac{\Delta s}{\Delta r} = 1\\[2pt]
        g_{11}
        &=
          h_x^2 = 1
      \end{align}
    \end{subequations}

  \item En cuanto al coeficiente de escala $h_\theta$, cuando se modifica $\theta$ en una
    cierta cantidad $\Delta\theta$, la distancia que se recorre en el espacio es
    el ángulo por el radio, $\Delta s = r\Delta\theta$. Además, $g_{22} = r^2$. Ver
    figura \ref{fig:R2-polares-intuicion-h-theta}
    \begin{subequations}
      \begin{align}
        h_\theta
        &=
          \dfrac{\Delta s}{\Delta\theta} = \dfrac{r\Delta\theta}{\Delta\theta} = r\\[2pt]
        g_{22}
        &=
          h_\theta^2 = r^2
      \end{align}
    \end{subequations}
    \begin{figure}[ht]
      \centering
      \begin{minipage}{0.40\linewidth}
        % Esta gráfica muestra cómo afecta un cambio en la coordenada r a la distancia
        % recorrida en el espacio R^2
        % Escala
        \def\scl{1.35}
        % 
        \pgfmathsetmacro{\EJESEXTRA}{-0.2}
        \pgfmathsetmacro{\EJESLONG}{2.5}
        % Eje x
        \pgfmathsetmacro{\XMLONG}{\EJESEXTRA}
        \pgfmathsetmacro{\XPLONG}{\EJESLONG}
        % Eje y
        \pgfmathsetmacro{\YMLONG}{\EJESEXTRA}
        \pgfmathsetmacro{\YPLONG}{\EJESLONG}
        % Punto P original
        \pgfmathsetmacro{\PMOD}{1.5}
        \pgfmathsetmacro{\PANG}{30}
        % Punto P final conservando el mismo ángulo
        \pgfmathsetmacro{\PFINMOD}{2.4}
        \pgfmathsetmacro{\PFINANG}{\PANG}      
        % Fondo
        \pgfmathsetmacro{\HORZ}{0.25}
        \pgfmathsetmacro{\VERT}{0.25}
        % 
        \centering
        \begin{tikzpicture}[%
          scale=\scl,
          every node/.style={black,font=\small},
          eje/.style={->},
          r/.style={line width=.8pt, black},
          rtxt/.style={black},
          rfin/.style={line width=1pt, \colorVred},
          rfintxt/.style={\colorTchg, rotate=\PANG},
          textooriginal/.style={\colorTorig},
          pcirculo/.style={black, radius=1pt},
          angulogirado/.style={fill=\colorAng, draw=\colorGirodos},
          background/.style={%
            line width=\bgborderwidth,
            draw=\bgbordercolor,
            fill=\bgcolor,
          },
          ]
          % COORDENADAS
          % Origen
          \coordinate (O) at (0,0);
          % Extremo izdo del eje x e inferior del eje y
          \coordinate (xini) at (\XMLONG cm,0);
          \coordinate (yini) at (0,\YMLONG cm);
          % Eje x
          \path[save path=\ejex] (xini) -- coordinate[pos=0.5] (xtexto)
          (\XPLONG cm, 0) coordinate (xfin);
          % Eje y
          \path[save path=\ejey] (yini) -- coordinate[pos=0.6] (ytexto)
          (0, \YPLONG cm) coordinate (yfin);
          % Punto P original
          \path[save path=\porig] (O) -- coordinate[pos=0.65] (rorigtxt)
          (\PANG:\PMOD cm) coordinate (P);
          % Punto P final
          \path[save path=\pfin] (P) -- coordinate[pos=0.5] (rfintxt)
          (\PFINANG:\PFINMOD cm) coordinate (P');
        
          % DIBUJOS
          % Ángulo theta
          \path (xfin) -- (O) -- (P) pic
          [-{Latex[width=2.5pt,length=3.7pt]},angulogirado,
          "\scriptsize $\theta$",angle radius=24pt, angle eccentricity=0.72]
          {angle = xfin--O--P};
          % Ejes
          % x
          \draw[eje, use path=\ejex];
          \node[right] at (xfin) {$x$};
          % y
          \draw[eje, use path=\ejey];
          \node[above] at (yfin) {$y$};
          % Coordenada r original
          \draw[r, use path=\porig];
          \node[rtxt, above left=-3pt and -1pt] at (rorigtxt) {\footnotesize $r$};
          % Vector r final
          \draw[rfin, use path=\pfin];
          \node[rfintxt, above] at (rfintxt) {\footnotesize $\Delta s = \Delta r$};
          % Puntos
          \fill[pcirculo] (P) circle;
          \fill[pcirculo] (P') circle;
          \node[rtxt, below right] at (P) {\scriptsize $P$};
          \node[rtxt, below right] at (P') {\scriptsize $P'$};
          % Origen
          \filldraw (O) circle [radius=.4pt];
          % Fondo amarillo
          \coordinate (SW)
          at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
          \coordinate (NE)
          at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);
          \begin{scope}[on background layer]
            \draw[background] (SW) rectangle (NE);
          \end{scope}
        \end{tikzpicture}
        \caption{Al cambiar la coordenada $r$, manteniendo constante $\theta$, se recorre
          una distancia igual en el espacio $\symbb{R}^2$. Por tanto, $h_r=1$ y
          $g_{11} = 1$.}
        \label{fig:R2-polares-intuicion-h-r}
      \end{minipage}
      \hspace{1em}
      \begin{minipage}{0.40\linewidth}
        % Escala
        \def\scl{1.35}
        % 
        \pgfmathsetmacro{\EJESEXTRA}{-0.2}
        \pgfmathsetmacro{\EJESLONG}{2.5}
        % Eje x
        \pgfmathsetmacro{\XMLONG}{\EJESEXTRA}
        \pgfmathsetmacro{\XPLONG}{\EJESLONG}
        % Eje y
        \pgfmathsetmacro{\YMLONG}{\EJESEXTRA}
        \pgfmathsetmacro{\YPLONG}{\EJESLONG}
        % Punto P original
        \pgfmathsetmacro{\PMOD}{2.0}
        \pgfmathsetmacro{\PANG}{25}
        % Punto P final conservando el mismo radio
        \pgfmathsetmacro{\PFINMOD}{\PMOD}
        \pgfmathsetmacro{\PFINANG}{70}
        % Texto en arco
        \pgfmathsetmacro{\PARCANG}{0.5*(\PFINANG) + \PANG)}
        \pgfmathsetmacro{\PARCMOD}{\PMOD * 1.2}
        % Fondo
        \pgfmathsetmacro{\HORZ}{0.25}
        \pgfmathsetmacro{\VERT}{0.25}
        % 
        \centering
        \begin{tikzpicture}[%
          scale=\scl,
          every node/.style={black,font=\small},
          eje/.style={->},
          r/.style={line width=.8pt, black},
          rtxt/.style={black},
          rfin/.style={line width=1pt, \colorVred},
          rfintxt/.style={\colorTchg},
          textooriginal/.style={\colorTorig},
          pcirculo/.style={black, radius=1pt},
          angulo/.style={fill=\colorAng, draw=\colorGirodos},
          angulogirado/.style={fill=\colorAngPink, draw=\colorGiroRed},
          arco/.style={line width=1pt, draw=\colorGiroRed},
          background/.style={%
            line width=\bgborderwidth,
            draw=\bgbordercolor,
            fill=\bgcolor,
          },
          ]

          % COORDENADAS
          % Origen
          \coordinate (O) at (0,0);
          % Extremo izdo del eje x e inferior del eje y
          \coordinate (xini) at (\XMLONG cm,0);
          \coordinate (yini) at (0,\YMLONG cm);
          % Eje x
          \path[save path=\ejex] (xini) -- coordinate[pos=0.5] (xtexto)
          (\XPLONG cm, 0) coordinate (xfin);
          % Eje y
          \path[save path=\ejey] (yini) -- coordinate[pos=0.6] (ytexto)
          (0, \YPLONG cm) coordinate (yfin);
          % Punto P original
          \path[save path=\porig] (O) -- coordinate[pos=0.65] (rorigtxt)
          (\PANG:\PMOD cm) coordinate (P);
          % Punto P final
          \path[save path=\pfin] (O) -- coordinate[pos=0.65] (rfintxt)
          (\PFINANG:\PFINMOD cm) coordinate (P');

          % DIBUJOS
          % Ángulo theta
          \path (xfin) -- (O) -- (P) pic
          [angulo, "\scriptsize $\theta$",angle radius=24pt, angle eccentricity=0.72]
          {angle = xfin--O--P};
          % Incremento de theta
          \path (P) -- (O) -- (P') pic
          [-{Latex[width=3.0pt,length=4.5pt]}, angulogirado,
          "\scriptsize $\Delta\theta$",angle radius=24pt, angle eccentricity=0.72]
          {angle = P--O--P'};
          % Ejes
          % x
          \draw[eje, use path=\ejex];
          \node[right] at (xfin) {$x$};
          % y
          \draw[eje, use path=\ejey];
          \node[above] at (yfin) {$y$};
          % Longitud r original
          \draw[r, use path=\porig];
          \node[rtxt, below right=-2pt and 0pt] at (rorigtxt) {\footnotesize $r$};
          % Longitud r final
          \draw[r, use path=\pfin];
          \node[rtxt, above left = -2pt and 0pt] at (rfintxt) {\footnotesize $r$};
          % Arco recorrido
          \draw[arco] (P) arc (\PANG:\PFINANG:\PMOD)
          node[rfintxt,above,midway,sloped] {\footnotesize$\Delta s = r\Delta\theta$};
        
          % Puntos
          \fill[pcirculo] (P) circle;
          \fill[pcirculo] (P') circle;
          \node[rtxt, below right=-3pt and 0pt] at (P) {\scriptsize $P$};
          \node[rtxt, above left=0pt and -3pt] at (P') {\scriptsize $P'$};
          % Origen
          \filldraw (O) circle [radius=.4pt];
          % Fondo amarillo
          \coordinate (SW)
          at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
          \coordinate (NE)
          at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);
          \begin{scope}[on background layer]
            \draw[background] (SW) rectangle (NE);
          \end{scope}

        \end{tikzpicture}
        \caption{Al cambiar la coordenada $\theta$, manteniendo $r$ constante, se  recorre
          una distancia proporcional a $r$ y a $\Delta\theta$. Por tanto, $h_\theta = r$ y
          $g_{22} = r^2$.}
        \label{fig:R2-polares-intuicion-h-theta}
      \end{minipage}
    \end{figure}
  \end{itemize}
  
\end{enumerate}

\subsection{Gradiente}
Cálculos preliminares. Se utilizan las expresiones \eqref{eq:R2-x-rtheta},
\eqref{eq:R2-y-rtheta}, \eqref{eq:R2-r-xy} y \eqref{eq:R2-theta-xy}
{\small
\begin{subequations}
  \begin{align}
    \dfrac{\partial r}{\partial x}
    &=
      \dfrac{1}{\cancelout{2}\sqrt{x^2+y^2}}\cdot \cancelout{2}x
      = \dfrac{\cancelout{r}\cos\theta}{\cancelout{r}} = \cos\theta\\
    \dfrac{\partial r}{\partial y}
    &=
      \dfrac{1}{\cancelout{2}\sqrt{x^2+y^2}}\cdot \cancelout{2}y
      = \dfrac{\cancelout{r}\sin\theta}{\cancelout{r}} = \sin\theta\\
    \dfrac{\partial\theta}{\partial x}
    &=
      \dfrac{1}{1+\dfrac{y^2}{x^2}}\,\left(-\dfrac{y}{x}\right)
      = -\dfrac{x^{\cancelout{\scriptstyle{2}}}}{x^2+y^2}\,\dfrac{y}{\cancelout{x}}
      = -\dfrac{y}{x^2+y^2}
      = -\dfrac{\cancelout{r}\sin\theta}{r^{\cancelout{2}}}
      = -\dfrac{\sin\theta}{r}\\
    \dfrac{\partial\theta}{\partial x}
    &=
      \dfrac{1}{1+\dfrac{y^2}{x^2}}\,\dfrac{1}{x}
      = \dfrac{x^{\cancelout{\scriptstyle{2}}}}{x^2+y^2}\,\dfrac{1}{\cancelout{x}}
      = \dfrac{y}{x^2+y^2}
      = \dfrac{\cancelout{r}\cos\theta}{r^{\cancelout{\scriptstyle{2}}}}
      = \dfrac{\cos\theta}{r}
  \end{align}
\end{subequations}
}
{\small
  \begin{subequations}
    \begin{align*}
      \dfrac{\partial f}{\partial x}\,\uvec{\i}
      &=
        \left(%
        \dfrac{\partial f}{\partial r}\dfrac{\partial r}{\partial x}
        + \dfrac{\partial f}{\partial\theta}\dfrac{\partial\theta}{\partial x}
        \right)
        \left(%
        \cos\theta\,\xhat{r}-\sin\theta\,\xhat{\theta}
        \right)\\
      &=
        \left[%
        \dfrac{\partial f}{\partial r}\cos\theta
        + \dfrac{\partial f}{\partial\theta}\left(-\dfrac{\sin\theta}{r}\right)
        \right]
        \left(%
        \cos\theta\,\xhat{r} - \sin\theta\,\xhat{\theta}
        \right)\\
      &=
        \cos^2\theta\dfrac{\partial f}{\partial r}\,\xhat{r}
        -\dfrac{\sin\theta\cos\theta}{r}\dfrac{\partial f}{\partial\theta}\,\xhat{r}
        - \sin\theta\cos\theta\dfrac{\partial f}{\partial r}\,\xhat{\theta}
        + \dfrac{\cos^2\theta}{r}\dfrac{\partial f}{\partial\theta}\,\xhat{\theta}
    \end{align*}
  \end{subequations}
}
{\small
  \begin{subequations}
    \begin{align*}
      \dfrac{\partial f}{\partial y}\,\uvec{\j}
      &=
        \left(%
        \dfrac{\partial f}{\partial r}\dfrac{\partial f}{\partial y}
        + \dfrac{\partial f}{\partial\theta}\dfrac{\partial\theta}{\partial y}
        \right)
        \left(%
        \sin\theta\,\xhat{r}-\cos\theta\,\xhat{\theta}
        \right)\\
      &=
        \left[%
        \dfrac{\partial f}{\partial r}\sin\theta
        + \dfrac{\partial f}{\partial\theta}\dfrac{\cos\theta}{r}
        \right]
        \left(%
        \sin\theta\,\xhat{r} - \cos\theta\,\xhat{\theta}
        \right)\\
      &=
        \sin^2\theta\dfrac{\partial f}{\partial r}\,\xhat{r}
        + \dfrac{\sin\theta\cos\theta}{r}\dfrac{\partial f}{\partial\theta}\,\xhat{r}
        + \sin\theta\cos\theta\dfrac{\partial f}{\partial r}\,\xhat{\theta}
        + \dfrac{\cos^2\theta}{r}\dfrac{\partial f}{\partial\theta}\,\xhat{\theta}
    \end{align*}
  \end{subequations}
}

El gradiente en polares se obtiene sustituyendo las dos expresiones anteriores en
\eqref{eq:R2-gradiente-cartesianas} y sumando. A continuación presentamos el resultado
{\small
  \begin{equation}\label{eq:R2-gradiente-polares}
    \vvv{\nabla}\cdot f
    =
      \dfrac{\partial f}{\partial x}\,\uvec{\i}
      + \dfrac{\partial f}{\partial y}\,\uvec{\j}
      = \dfrac{\partial f}{\partial r}\,\xhat{r}
      + \dfrac{1}{r}\dfrac{\partial f}{\partial\theta}\,\xhat{\theta}
  \end{equation}
}

\subsection{Divergencia}
La divergencia de un campo vectorial en polares la calcularemos de varias formas pero,
sin que sirva de precedente, la primera que presentaré no es correcta.

Realizamos un cálculo matricial, similar al realizado en coordenadas cartesianas,
teniendo en cuenta que en este producto escalar se utiliza la métrica en polares
\eqref{eq:R2-metrica-polares}
\begin{equation}
  \vvv{\nabla}\cdot\vvv{A}
  \neq
  \cancelout{%
    \begin{pmatrix}
      \partial/\partial r & \partial/\partial\theta      
    \end{pmatrix}
    \begin{pmatrix}
      1 & 0\\
      0 & r^2
    \end{pmatrix}
    \begin{pmatrix}
      A_r\\
      A_\theta
    \end{pmatrix}
  }
  = \cancelout{%
    \dfrac{\partial A_r}{\partial r}
    + \dfrac{\partial r^2A_\theta}{\partial\theta}
  }
\end{equation}
¿Por qué no es correcto este cálculo, si se ha utilizado la métrica correcta en
polares, de forma similar a lo que se hizo en cartesianas, ver
\eqref{eq:R2-divergencia-cartesianas}?

% \hspace{1em}
No lo es porque, aunque hemos utilizado la métrica, esta no es lo único que cambia
cuando se pasa de cartesianas a polares, esto es, no solo cambian las distancias
(la métrica), sino también cambian los vectores de la base con la posición en el plano.
En este cálculo matricial, y en el que se realizó en cartesianas, estaba implícito el
que los vectores de la base eran inmutables, lo que es correcto en cartesianas pero no
lo es en polares, dado que estos cambian con la posición en el plano $\symbb{R}^2$.

En resumen, el sistema de coordenadas polares es curvilíneo ver figura
\ref{fig:R2-coordenadas-polares}, y esa curvatura hay quetenerla en cuenta.

\begin{figure}[ht]
  % Escala
  \def\scl{0.9}
  % 
  % Número de círcunferencias
  \pgfmathsetmacro{\NUMCIRC}{5}
  % Longitud de un versor
  \pgfmathsetmacro{\VERSOR}{0.5}
  % Longitud de línea radial
  \pgfmathsetmacro{\LINEARADIAL}{\NUMCIRC * \VERSOR + 0.25}
  % Fondo
  \pgfmathsetmacro{\HORZ}{0.25}
  \pgfmathsetmacro{\VERT}{0.25}
  % 
  \centering
  \begin{tikzpicture}[%
    scale=\scl,
    every node/.style={black,font=\small},
    vtexto/.style={font=\footnotesize, pos=1.4},
    vtheta/.style={-{Latex[round, width=4pt, length=5pt]},
      line width=0.6pt, \colorVred},
    vr/.style={vtheta, \colorV},
    polares/.style={draw=black!25, line width=0.4pt},
    punto/.style={fill=black, radius=1.25pt},
    background/.style={%
      line width=\bgborderwidth,
      draw=\bgbordercolor,
      fill=\bgcolor
    },
    ]
    % COORDENADAS
    % Origen
    \coordinate (O) at (0,0);
    
    % DIBUJOS
    % Coordenadas polares (Radios de los ángulos)
    \foreach \angulo / \label
    in {%
      0/{0}, 30/{\pi/6}, 60/{\pi/3},
      90/{\pi/2}, 120/{2\pi/3}, 150/{5\pi/6},
      180/{\pi}, 210/{7\pi/6}, 240/{4\pi/3},
      270/{3\pi/2}, 300/{5\pi/3}, 330/{11\pi/6}
    }
    {%
      \draw[polares] (O) -- ++(\angulo:\LINEARADIAL)
      node[pos=1.12] {\scriptsize $\label$};
    };
    \foreach \radio [evaluate=\radio] in {\VERSOR*1,\VERSOR*...,\VERSOR*\NUMCIRC}
    {%
      % Circunferencias
      \draw[polares] (O) circle[radius=\radio cm];
    };
    
    % Vectores unitarios en r=1.0
    \foreach \radio [evaluate=\radio] in{\VERSOR*1}
    \foreach \angulo in {30}
    {%
      % Vectores unitario radiales
      \draw[vr] (O) ++(\angulo:\radio) -- ++(\angulo:\VERSOR)
      node[vtexto, rotate=\angulo-90] {$\xhat{r}$};
      % Vectores unitarios angulares
      \draw[vtheta] (O) ++(\angulo:\radio) -- ++(90+\angulo:\VERSOR)
      node[vtexto, rotate=\angulo-90, \colorTred] {$\xhat{\theta}$};
      % Posición
      \fill[punto] (O) ++(\angulo:\radio) circle;
    };
    
    % Vectores unitarios en r=2.0
    \foreach \radio [evaluate=\radio] in{\VERSOR*2}
    \foreach \angulo in {150}
    {%
      % Vectores unitario radiales
      \draw[vr] (O) ++(\angulo:\radio) -- ++(\angulo:\VERSOR)
      node[vtexto, rotate=\angulo-90] {$\xhat{r}$};
      % Vectores unitarios angulares
      \draw[vtheta] (O) ++(\angulo:\radio) -- ++(90+\angulo:\VERSOR)
      node[vtexto, rotate=\angulo-90, \colorTred] {$\xhat{\theta}$};
      % Posición
      \fill[punto] (O) ++(\angulo:\radio) circle;
    };
    
    % Vectores unitarios en r=3.0
    \foreach \radio [evaluate=\radio] in{\VERSOR*3}
    \foreach \angulo in {210, 330}
    {%
      % Vectores unitario radiales
      \draw[vr] (O) ++(\angulo:\radio) -- ++(\angulo:\VERSOR)
      node[vtexto, rotate=\angulo-90] {$\xhat{r}$};
      % Vectores unitarios angulares
      \draw[vtheta] (O) ++(\angulo:\radio) -- ++(90+\angulo:\VERSOR)
      node[vtexto, rotate=\angulo-90, \colorTred] {$\xhat{\theta}$};
      % Posición
      \fill[punto] (O) ++(\angulo:\radio) circle;
    };
    
    % Vectores unitarios en r=4.0
    \foreach \radio [evaluate=\radio] in{\VERSOR*4}
    \foreach \angulo in {30,90,270}
    {%
      % Vectores unitario radiales
      \draw[vr] (O) ++(\angulo:\radio) -- ++(\angulo:\VERSOR)
      node[vtexto, rotate=\angulo-90] {$\xhat{r}$};
      % Vectores unitarios angulares
      \draw[vtheta] (O) ++(\angulo:\radio) -- ++(90+\angulo:\VERSOR)
      node[vtexto, rotate=\angulo-90, \colorTred] {$\xhat{\theta}$};
      % Posición
      \fill[punto] (O) ++(\angulo:\radio) circle;
    };      
    
    % Origen
    \filldraw (O) circle [radius=.2pt];
    
    % Fondo amarillo
    \coordinate (SW) at ($(current bounding box.south west) + (-\HORZ cm,-\VERT cm)$);
    \coordinate (NE) at ($(current bounding box.north east) + (\HORZ cm,\VERT cm)$);
    \begin{scope}[on background layer]
      \draw[background] (SW) rectangle (NE);
    \end{scope}
  \end{tikzpicture}
  \caption{Coordenadas polares (curvilíneas), donde $r$ representa la distancia al
    origen (polo) y $\theta$ es el ángulo que forma el vector de posición con el eje
    $x$, aquí expresado en radianes. Además se muestran algunos vectores unidad
    $\xhat{r}$ y $\xhat{\theta}$ en distintas posiciones del plano $\symbb{R}^2$.}
  \label{fig:R2-coordenadas-polares}
\end{figure}
¿Entonces, no se puede plantear un enfoque matricial para obtener la divergencia en
polares? Sí es posible, y lo veremos al final.

\begin{enumerate}
\item Enfoque basado en la variación de los vectores unitarios.
  
  Cuando el operador nabla actúa sobre un campo vectorial como
  $\vvv{A} = A_r\xhat{r}+A_\theta\xhat{\theta}$, no solo actúa sobre las componentes
  $A_r$ y $A_\theta$, sino también sobre los vectores unitarios $\xhat{r}$ y
  $\xhat{\theta}$,
  ver \eqref{eq:R2-versor-r} y \eqref{eq:R2-versor-theta}. Necesitaremos las derivadas
  de los versores de la base que se calcularon en \eqref{eq:R2-partial-versor_r-r},
  \eqref{eq:R2-partial-versor_theta-r}, \eqref{eq:R2-partial-versor_r-theta} y
  \eqref{eq:R2-partial-versor_theta-theta}, que resumimos a continuación:
  \begin{itemize}
  \item Al desplazarnos radialmente, los versores $\xhat{r}$ y $\xhat{\theta}$ no
    cambian, ver ángulo $\pi/6$\,\unit{\radian} en la figura
    \ref{fig:R2-coordenadas-polares}
    \begin{equation}
      \dfrac{\partial\xhat{r}}{\partial r} = \dfrac{\partial\xhat{\theta}}{\partial r}
      = 0
    \end{equation}
  \item Al rotar infinitesimalmente en sentido antihorario, $\xhat{r}$ cambia según
    $\xhat{\theta}$, ver por ejemplo, ángulos $\pi/6$\,\unit{\radian} y
    $\pi/2$\,\unit{\radian} en la figura \ref{fig:R2-coordenadas-polares}
    \begin{equation}
      \dfrac{\partial\xhat{r}}{\partial\theta} = \xhat{\theta}
    \end{equation}
  \item Al desplazarnos infinitesimalmente en sentido antihorario, $\xhat{\theta}$ cambia
    según el sentido contrario a $\xhat{r}$, ver por ejemplo, ángulos
    $\pi/6$\,\unit{\radian} y $\pi/2$\,\unit{\radian} en la
    figura~\ref{fig:R2-coordenadas-polares}
    \begin{equation}
      \dfrac{\partial\xhat{\theta}}{\partial\theta} = -\xhat{r}
    \end{equation}
    
  \item También necesitamos el operador nabla en polares, que podemos obtenerlo a
    partir del gradiente de un campo escalar en polares \eqref{eq:R2-gradiente-polares}
    \begin{equation}
      \vvv{\nabla}
      = \xhat{r}\,\dfrac{\partial}{\partial r}
      + \xhat{\theta}\,\dfrac{1}{r}\dfrac{\partial}{\partial\theta}
    \end{equation}
  \end{itemize}
  
  Con todo lo anterior, planteamos el cálculo de la divergencia de un campo vectorial en
  polares
  \[
    \vvv{\nabla}\cdot\vvv{A}
    =
    \left(%
      \xhat{r}\dfrac{\partial}{\partial r}
      + \xhat{\theta}\dfrac{\partial}{\partial\theta}
    \right)
    \cdot
    (A_r\xhat{r}+A_\theta\xhat{\theta})
  \]
  Obtenemos dos sumandos
  \begin{equation}\label{eq:R2-divergencia-sumandos}
    \vvv{\nabla}\cdot\vvv{A}
    = \xhat{r}\cdot
    \dfrac{\partial}{\partial r}\left(A_r\xhat{r}+A_\theta\xhat{\theta}\right)
    + \dfrac{1}{r}\xhat{\theta}\cdot\dfrac{\partial}{\partial\theta}
    \left(A_r\xhat{r}+A_\theta\xhat{\theta}\right)
  \end{equation}
  
  Desarrollamos el primer sumando, teniendo en cuenta que se anulan, tanto las derivadas
  parciales con respecto a $r$, como el término que contiene a $\xhat{\theta}$, dado que
  al multiplicarlo por $\xhat{r}$ dará cero, ya que son ortogonales
  \begin{align*}
    \xhat{r}\cdot
    \dfrac{\partial}{\partial r}\left(A_r\xhat{r}+A_\theta\xhat{\theta}\right)
    &=
      \xhat{r}\cdot
      \left(%
      \dfrac{\partial A_r}{\partial r}\xhat{r}
      + \cancelout{A_r\dfrac{\partial\xhat{r}}{\partial r}}
      + \cancelout{\dfrac{\partial A_\theta}{\partial r}\xhat{\theta}}
      + \cancelout{A_\theta\dfrac{\partial\xhat{\theta}}{\partial r}}
      \right)\\
    &=
      \dfrac{\partial A_r}{\partial r}\,\xhat{r}\cdot\xhat{r}
      = \dfrac{\partial A_r}{\partial r}
  \end{align*}
  Ahora desarrollamos el último sumando, sustituyendo el valor de las derivadas parciales
  y teniendo en cuenta que $\xhat{r}$ y $\xhat{\theta}$ son ortogonales
  \begin{align*}
    \dfrac{1}{r}\xhat{\theta}\cdot\dfrac{\partial}{\partial\theta}
    \left(A_r\xhat{r}+A_\theta\xhat{\theta}\right)
    &=
      \dfrac{1}{r}\xhat{\theta}\cdot
      \left(%
      \cancelout{\dfrac{\partial A_r}{\partial\theta}\xhat{r}}
      + A_r\dfrac{\partial\xhat{r}}{\partial\theta}
      + \dfrac{\partial A_\theta}{\partial\theta}\xhat{\theta}
      + A_\theta\dfrac{\partial\xhat{\theta}}{\partial\theta}
      \right)\\
    &= 
      \dfrac{1}{r}\xhat{\theta}\cdot
      \left(%
      A_r\xhat{\theta}
      + \dfrac{\partial A_\theta}{\partial\theta}\xhat{\theta}
      + \cancelout{A_\theta\,(-\xhat{r})}
      \right)\\
    &=
      \dfrac{1}{r}
      \left(%
      A_r + \dfrac{\partial A_\theta}{\partial\theta}
      \right)
      \xhat{\theta}\cdot\xhat{\theta}
      = \dfrac{1}{r}\dfrac{\partial A_\theta}{\partial\theta}
      + \dfrac{1}{r}A_r
  \end{align*}
  
  Sustituimos estos resultados en los dos sumandos de la divergencia
  \eqref{eq:R2-divergencia-sumandos}
  \[
    \vvv{\nabla}\cdot\vvv{A}
    = \dfrac{\partial A_r}{\partial r}
    + \dfrac{1}{r} A_r
    + \dfrac{1}{r} \dfrac{\partial A_\theta}{\partial\theta}
  \]
  
  Agrupando términos obtenemos la divergencia en polares
  \begin{equation}\label{eq:R2-divergencia-polares}
    \vvv{\nabla}\cdot\vvv{A}
    = \dfrac{1}{r}\dfrac{\partial}{\partial r}(rA_r)
    + \dfrac{1}{r}\dfrac{\partial A_\theta}{\partial\theta}
  \end{equation}

\item Cálculo utilizando la métrica y válido en polares y en espacios curvos
  \begin{equation}
    \vvv{\nabla}\cdot\vvv{A}
    = \dfrac{1}{\sqrt{g}}\,\partial_i\big(\sqrt{g} A^i\big)
  \end{equation}
  Aplicando la fórmula, sabiendo que la raíz cuadrada del valor absoluto de la métrica
  es $g=r$ y que $r$ es independiente de $\theta$
  \begin{align*}
    \vvv{\nabla}\cdot\vvv{A}
    &=
      \dfrac{1}{r}\,\left[%
      \partial_r\!\left(rA^r\right) + \partial_\theta\!\left(rA^\theta\right)
      \right]
    =
      \dfrac{1}{r}\,\left[%
      \partial_r\!\left(rA^r\right) + r\,\partial_\theta A^\theta
      \right]      
  \end{align*}
  donde $A^r$ y $A^\theta$ son las componentes contravariantes del vector. En física
  normalmente se usan las componentes covariantes $A_r$ y $A_\theta$.

  Calculamos la inversa del tensor métrico, que como es diagonal, la inversa de cada
  elemento es el recíproco de los elementos diagonales
  \begin{equation}
    \mmm{g} = \begin{pmatrix}1 & 0\\ 0 & 1/r^2 \end{pmatrix}
  \end{equation}
  Para bajar el índice, multiplicamos por la inversa del  tensor métrico $A^i = g^{ij}
  A_j$.
  Así, desarrollando el sumatorio
  \begin{align*}
    A^r
    &=
      g^{rr}A_r + g^{r\theta}A_\theta = 1\cdot A_r + 0\cdot A_\theta = A_r\\
    A^\theta
    &=
      g^{\theta r}A_r + g^{\theta\theta}A_\theta = 0\cdot A_r + \dfrac{1}{r^2} A_\theta
      = \dfrac{1}{r^2}A_\theta
  \end{align*}
  Sustituimos en
  \begin{align*}
    \vvv{\nabla}\cdot\vvv{A}
    = \dfrac{1}{r}\left[%
    \dfrac{\partial}{\partial r}\!\left(r\,A_r\right)
    + r\, \partial_\theta\left(\dfrac{1}{r^2}\, A_\theta\right)
    \right]
    = \dfrac{1}{r}\left[%
    \dfrac{\partial}{\partial r}\!\left(r\,A_r\right)
    + \dfrac{1}{r}\, \partial_\theta A_\theta
    \right]
  \end{align*}
  
\end{enumerate}


\subsection{Laplaciana} 

\subsection{Elemento de área en coordenadas polares planas}
\begin{align*}
  d^2a
  &=
    \dfrac{\partial(x,y)}{\partial(r,\theta)} dr\,d\theta
  = \begin{vmatrix}
    \partial x/\partial r & \partial x/\partial\theta\\
    \partial y/\partial r & \partial y/\partial\theta
  \end{vmatrix}
  dr\,d\theta
  = \begin{vmatrix}
    \cos\theta & -r\sin\theta\\
    \sin\theta & r\cos\theta
  \end{vmatrix}
    dr\,d\theta\\
  &=
    (r\cos^2\theta + r\sin^2\theta)\,dr\,d\theta
    = r (\cos^2\theta + \sin^2\theta)\,dr\,d\theta
\end{align*}
donde hemos utilizado las relaciones \eqref{eq:R2-x-rtheta} y \eqref{eq:R2-y-rtheta}.
Simplificando finalmente, queda
\begin{equation}
  d^2a = rdr\,d\theta
\end{equation}



%%% Local Variables:
%%% mode: latex
%%% TeX-engine: luatex
%%% TeX-master: "../retazosmatematicas.tex"
%%% End:
